============================================================================================== 
Warning! Mixing Conda and module environments may lead to corruption of the
user environment. 
We do not recommend users mixing those two environments unless absolutely
necessary. Note that 
SURF does not provide any support for Conda environment.
For more information, please refer to our software policy page:
https://servicedesk.surf.nl/wiki/display/WIKI/Software+policy+Snellius#SoftwarepolicySnellius-UseofAnacondaandMinicondaenvironmentsonSnellius 

Remember that many packages have already been installed on the system and can
be loaded using 
the 'module load <package__name>' command. If you are uncertain if a package is
already available 
on the system, please use 'module avail' or 'module spider' to search for it.
============================================================================================== 

EnvironmentNameNotFound: Could not find conda environment: power_of_noise
You can list all discoverable environments with `conda info --envs`.


Note: huggingface-cli login failed, but HF_TOKEN is set
==========================================
Running experiment: near scenario with random documents
Number of documents: 3
Gold position: 2
Use random: True
Batch size: 30
==========================================
`torch_dtype` is deprecated! Use `dtype` instead!
Loading LLM...
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 14.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  8.93s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.78s/it]
LLM loaded
Loading corpus and search results...
Corpus and search results loaded
Loading prompt dataset...
Prompt dataset loaded
INFO:
DATA: data/10k_train_dataset.json
MODEL: meta-llama/Llama-2-7b-chat-hf
USE RANDOM IN CONTEXT: True
USE ADORE: False
GOLD POSITION: 2
NUM DOCUMENTS IN CONTEXT: 3
DOCUMENTS WITHOUT ANSWER: True
REPEAT GOLD: False
PAD GOLD: False
BATCH SIZE: 30
SAVE EVERY: 250
  0%|          | 0/334 [00:00<?, ?it/s]The following generation flags are not valid and may be ignored: ['temperature', 'top_p']. Set `TRANSFORMERS_VERBOSITY=info` for more details.
  0%|          | 1/334 [00:09<52:37,  9.48s/it]  1%|          | 2/334 [00:19<54:22,  9.83s/it]  1%|          | 3/334 [00:29<54:03,  9.80s/it]  1%|          | 4/334 [00:37<51:15,  9.32s/it]  1%|▏         | 5/334 [00:46<49:07,  8.96s/it]  2%|▏         | 6/334 [00:54<47:03,  8.61s/it]  2%|▏         | 7/334 [01:04<49:40,  9.11s/it]  2%|▏         | 8/334 [01:10<45:12,  8.32s/it]  3%|▎         | 9/334 [01:21<48:07,  8.88s/it]  3%|▎         | 10/334 [01:29<46:51,  8.68s/it]  3%|▎         | 11/334 [01:38<47:17,  8.78s/it]  4%|▎         | 12/334 [01:47<48:36,  9.06s/it]  4%|▍         | 13/334 [01:55<46:34,  8.70s/it]  4%|▍         | 14/334 [02:03<44:25,  8.33s/it]  4%|▍         | 15/334 [02:10<42:22,  7.97s/it]  5%|▍         | 16/334 [02:20<46:02,  8.69s/it]  5%|▌         | 17/334 [02:28<43:41,  8.27s/it]  5%|▌         | 18/334 [02:38<46:40,  8.86s/it]  6%|▌         | 19/334 [02:47<46:42,  8.90s/it]  6%|▌         | 20/334 [02:57<48:37,  9.29s/it]  6%|▋         | 21/334 [03:03<43:22,  8.31s/it]  7%|▋         | 22/334 [03:12<44:15,  8.51s/it]  7%|▋         | 23/334 [03:21<45:23,  8.76s/it]  7%|▋         | 24/334 [03:30<44:34,  8.63s/it]  7%|▋         | 25/334 [03:38<43:44,  8.49s/it]  8%|▊         | 26/334 [03:48<45:22,  8.84s/it]  8%|▊         | 27/334 [03:57<45:37,  8.92s/it]  8%|▊         | 28/334 [04:03<41:47,  8.20s/it]  9%|▊         | 29/334 [04:13<43:45,  8.61s/it]  9%|▉         | 30/334 [04:22<45:05,  8.90s/it]  9%|▉         | 31/334 [04:32<46:14,  9.16s/it] 10%|▉         | 32/334 [04:40<44:24,  8.82s/it] 10%|▉         | 33/334 [04:50<46:30,  9.27s/it] 10%|█         | 34/334 [05:00<47:18,  9.46s/it] 10%|█         | 35/334 [05:10<47:52,  9.61s/it] 11%|█         | 36/334 [05:17<43:32,  8.77s/it] 11%|█         | 37/334 [05:26<42:54,  8.67s/it] 11%|█▏        | 38/334 [05:35<43:59,  8.92s/it] 12%|█▏        | 39/334 [05:45<45:08,  9.18s/it] 12%|█▏        | 40/334 [05:51<41:14,  8.42s/it] 12%|█▏        | 41/334 [06:00<41:14,  8.45s/it] 13%|█▎        | 42/334 [06:07<39:33,  8.13s/it] 13%|█▎        | 43/334 [06:15<39:21,  8.12s/it] 13%|█▎        | 44/334 [06:25<41:43,  8.63s/it] 13%|█▎        | 45/334 [06:35<43:25,  9.02s/it] 14%|█▍        | 46/334 [06:43<40:57,  8.53s/it] 14%|█▍        | 47/334 [06:51<40:11,  8.40s/it] 14%|█▍        | 48/334 [07:00<41:37,  8.73s/it] 15%|█▍        | 49/334 [07:10<42:58,  9.05s/it] 15%|█▍        | 50/334 [07:20<43:36,  9.21s/it] 15%|█▌        | 51/334 [07:27<40:41,  8.63s/it] 16%|█▌        | 52/334 [07:37<43:08,  9.18s/it] 16%|█▌        | 53/334 [07:47<43:35,  9.31s/it] 16%|█▌        | 54/334 [07:57<44:30,  9.54s/it] 16%|█▋        | 55/334 [08:04<41:06,  8.84s/it] 17%|█▋        | 56/334 [08:11<38:31,  8.32s/it] 17%|█▋        | 57/334 [08:19<37:43,  8.17s/it] 17%|█▋        | 58/334 [08:29<39:15,  8.53s/it] 18%|█▊        | 59/334 [08:38<40:38,  8.87s/it] 18%|█▊        | 60/334 [08:47<40:59,  8.98s/it] 18%|█▊        | 61/334 [08:56<40:47,  8.97s/it] 19%|█▊        | 62/334 [09:06<42:02,  9.27s/it] 19%|█▉        | 63/334 [09:15<40:29,  8.96s/it] 19%|█▉        | 64/334 [09:24<41:13,  9.16s/it] 19%|█▉        | 65/334 [09:34<42:36,  9.50s/it] 20%|█▉        | 66/334 [09:43<41:21,  9.26s/it] 20%|██        | 67/334 [09:51<39:40,  8.92s/it] 20%|██        | 68/334 [09:59<38:34,  8.70s/it] 21%|██        | 69/334 [10:07<36:22,  8.23s/it] 21%|██        | 70/334 [10:17<38:30,  8.75s/it] 21%|██▏       | 71/334 [10:25<38:11,  8.71s/it] 22%|██▏       | 72/334 [10:35<39:57,  9.15s/it] 22%|██▏       | 73/334 [10:43<37:26,  8.61s/it] 22%|██▏       | 74/334 [10:52<38:30,  8.89s/it] 22%|██▏       | 75/334 [11:02<39:49,  9.23s/it] 23%|██▎       | 76/334 [11:09<35:53,  8.35s/it] 23%|██▎       | 77/334 [11:19<38:32,  9.00s/it] 23%|██▎       | 78/334 [11:28<37:40,  8.83s/it] 24%|██▎       | 79/334 [11:36<36:57,  8.70s/it] 24%|██▍       | 80/334 [11:46<37:59,  8.97s/it] 24%|██▍       | 81/334 [11:53<36:03,  8.55s/it] 25%|██▍       | 82/334 [12:02<36:20,  8.65s/it] 25%|██▍       | 83/334 [12:10<34:47,  8.32s/it] 25%|██▌       | 84/334 [12:18<34:58,  8.39s/it] 25%|██▌       | 85/334 [12:25<32:25,  7.81s/it] 26%|██▌       | 86/334 [12:34<34:51,  8.43s/it] 26%|██▌       | 87/334 [12:44<36:30,  8.87s/it] 26%|██▋       | 88/334 [12:52<35:27,  8.65s/it] 27%|██▋       | 89/334 [13:03<37:16,  9.13s/it] 27%|██▋       | 90/334 [13:11<36:28,  8.97s/it] 27%|██▋       | 91/334 [13:21<37:05,  9.16s/it] 28%|██▊       | 92/334 [13:31<37:56,  9.41s/it] 28%|██▊       | 93/334 [13:40<37:48,  9.41s/it] 28%|██▊       | 94/334 [13:50<37:26,  9.36s/it] 28%|██▊       | 95/334 [13:57<35:33,  8.93s/it] 29%|██▊       | 96/334 [14:07<36:05,  9.10s/it] 29%|██▉       | 97/334 [14:17<36:38,  9.27s/it] 29%|██▉       | 98/334 [14:27<38:04,  9.68s/it] 30%|██▉       | 99/334 [14:37<38:08,  9.74s/it] 30%|██▉       | 100/334 [14:47<38:34,  9.89s/it] 30%|███       | 101/334 [14:56<37:27,  9.65s/it] 31%|███       | 102/334 [15:06<37:36,  9.73s/it] 31%|███       | 103/334 [15:15<35:57,  9.34s/it] 31%|███       | 104/334 [15:24<35:59,  9.39s/it] 31%|███▏      | 105/334 [15:34<36:39,  9.60s/it] 32%|███▏      | 106/334 [15:44<36:41,  9.65s/it] 32%|███▏      | 107/334 [15:52<34:53,  9.22s/it] 32%|███▏      | 108/334 [16:02<35:20,  9.38s/it] 33%|███▎      | 109/334 [16:12<35:30,  9.47s/it] 33%|███▎      | 110/334 [16:22<35:43,  9.57s/it] 33%|███▎      | 111/334 [16:32<36:11,  9.74s/it] 34%|███▎      | 112/334 [16:40<34:36,  9.35s/it] 34%|███▍      | 113/334 [16:51<35:29,  9.63s/it] 34%|███▍      | 114/334 [17:01<35:48,  9.77s/it] 34%|███▍      | 115/334 [17:10<35:44,  9.79s/it] 35%|███▍      | 116/334 [17:19<34:32,  9.51s/it] 35%|███▌      | 117/334 [17:27<32:38,  9.02s/it] 35%|███▌      | 118/334 [17:37<33:26,  9.29s/it] 36%|███▌      | 119/334 [17:45<31:42,  8.85s/it] 36%|███▌      | 120/334 [17:52<29:38,  8.31s/it] 36%|███▌      | 121/334 [18:02<31:25,  8.85s/it] 37%|███▋      | 122/334 [18:11<31:51,  9.02s/it] 37%|███▋      | 123/334 [18:19<30:33,  8.69s/it] 37%|███▋      | 124/334 [18:29<31:48,  9.09s/it] 37%|███▋      | 125/334 [18:39<31:50,  9.14s/it] 38%|███▊      | 126/334 [18:48<32:16,  9.31s/it] 38%|███▊      | 127/334 [18:58<32:34,  9.44s/it] 38%|███▊      | 128/334 [19:06<30:24,  8.85s/it] 39%|███▊      | 129/334 [19:15<31:12,  9.13s/it] 39%|███▉      | 130/334 [19:23<28:59,  8.53s/it] 39%|███▉      | 131/334 [19:32<29:57,  8.86s/it] 40%|███▉      | 132/334 [19:39<27:41,  8.23s/it] 40%|███▉      | 133/334 [19:49<29:35,  8.83s/it] 40%|████      | 134/334 [19:59<30:27,  9.14s/it] 40%|████      | 135/334 [20:09<31:09,  9.39s/it] 41%|████      | 136/334 [20:17<29:08,  8.83s/it] 41%|████      | 137/334 [20:26<29:43,  9.05s/it] 41%|████▏     | 138/334 [20:33<27:21,  8.38s/it] 42%|████▏     | 139/334 [20:39<25:28,  7.84s/it] 42%|████▏     | 140/334 [20:49<26:30,  8.20s/it] 42%|████▏     | 141/334 [20:58<27:36,  8.58s/it] 43%|████▎     | 142/334 [21:08<28:39,  8.95s/it] 43%|████▎     | 143/334 [21:20<31:33,  9.91s/it] 43%|████▎     | 144/334 [21:30<31:35,  9.97s/it] 43%|████▎     | 145/334 [21:39<30:46,  9.77s/it] 44%|████▎     | 146/334 [21:46<27:39,  8.83s/it] 44%|████▍     | 147/334 [21:51<24:22,  7.82s/it] 44%|████▍     | 148/334 [22:01<25:48,  8.32s/it] 45%|████▍     | 149/334 [22:08<24:29,  7.94s/it] 45%|████▍     | 150/334 [22:18<26:06,  8.51s/it] 45%|████▌     | 151/334 [22:27<26:09,  8.58s/it] 46%|████▌     | 152/334 [22:35<25:31,  8.41s/it] 46%|████▌     | 153/334 [22:44<26:16,  8.71s/it] 46%|████▌     | 154/334 [22:54<27:04,  9.02s/it] 46%|████▋     | 155/334 [23:03<27:15,  9.14s/it] 47%|████▋     | 156/334 [23:09<23:43,  8.00s/it] 47%|████▋     | 157/334 [23:16<22:56,  7.78s/it] 47%|████▋     | 158/334 [23:26<25:05,  8.56s/it] 48%|████▊     | 159/334 [23:36<26:13,  8.99s/it] 48%|████▊     | 160/334 [23:44<25:28,  8.78s/it] 48%|████▊     | 161/334 [23:54<26:02,  9.03s/it] 49%|████▊     | 162/334 [24:04<26:39,  9.30s/it] 49%|████▉     | 163/334 [24:14<26:56,  9.45s/it] 49%|████▉     | 164/334 [24:23<26:49,  9.47s/it] 49%|████▉     | 165/334 [24:31<25:12,  8.95s/it] 50%|████▉     | 166/334 [24:37<22:56,  8.19s/it] 50%|█████     | 167/334 [24:48<24:23,  8.76s/it] 50%|█████     | 168/334 [24:57<25:00,  9.04s/it] 51%|█████     | 169/334 [25:04<23:09,  8.42s/it] 51%|█████     | 170/334 [25:14<23:54,  8.75s/it] 51%|█████     | 171/334 [25:19<21:01,  7.74s/it] 51%|█████▏    | 172/334 [25:27<21:14,  7.87s/it] 52%|█████▏    | 173/334 [25:34<20:07,  7.50s/it] 52%|█████▏    | 174/334 [25:44<21:58,  8.24s/it] 52%|█████▏    | 175/334 [25:51<20:58,  7.92s/it] 53%|█████▎    | 176/334 [26:00<21:58,  8.35s/it] 53%|█████▎    | 177/334 [26:09<21:50,  8.34s/it] 53%|█████▎    | 178/334 [26:16<21:11,  8.15s/it] 54%|█████▎    | 179/334 [26:25<21:13,  8.21s/it] 54%|█████▍    | 180/334 [26:32<20:35,  8.02s/it] 54%|█████▍    | 181/334 [26:41<20:40,  8.11s/it] 54%|█████▍    | 182/334 [26:50<21:36,  8.53s/it] 55%|█████▍    | 183/334 [27:00<22:19,  8.87s/it] 55%|█████▌    | 184/334 [27:10<22:51,  9.14s/it] 55%|█████▌    | 185/334 [27:19<23:05,  9.30s/it] 56%|█████▌    | 186/334 [27:27<21:39,  8.78s/it] 56%|█████▌    | 187/334 [27:36<21:35,  8.82s/it] 56%|█████▋    | 188/334 [27:45<21:53,  9.00s/it] 57%|█████▋    | 189/334 [27:55<22:08,  9.16s/it] 57%|█████▋    | 190/334 [28:04<22:11,  9.24s/it] 57%|█████▋    | 191/334 [28:12<20:59,  8.81s/it] 57%|█████▋    | 192/334 [28:21<20:57,  8.85s/it] 58%|█████▊    | 193/334 [28:30<20:48,  8.86s/it] 58%|█████▊    | 194/334 [28:38<20:05,  8.61s/it] 58%|█████▊    | 195/334 [28:46<19:27,  8.40s/it] 59%|█████▊    | 196/334 [28:55<20:09,  8.76s/it] 59%|█████▉    | 197/334 [29:02<18:50,  8.25s/it] 59%|█████▉    | 198/334 [29:08<17:01,  7.51s/it] 60%|█████▉    | 199/334 [29:16<17:13,  7.65s/it] 60%|█████▉    | 200/334 [29:26<18:22,  8.22s/it] 60%|██████    | 201/334 [29:36<19:39,  8.87s/it] 60%|██████    | 202/334 [29:46<19:54,  9.05s/it] 61%|██████    | 203/334 [29:53<18:22,  8.42s/it] 61%|██████    | 204/334 [30:03<19:21,  8.93s/it] 61%|██████▏   | 205/334 [30:12<19:31,  9.08s/it] 62%|██████▏   | 206/334 [30:22<20:01,  9.39s/it] 62%|██████▏   | 207/334 [30:32<19:55,  9.41s/it] 62%|██████▏   | 208/334 [30:41<20:00,  9.53s/it] 63%|██████▎   | 209/334 [30:51<19:52,  9.54s/it] 63%|██████▎   | 210/334 [31:01<20:04,  9.71s/it] 63%|██████▎   | 211/334 [31:10<19:39,  9.59s/it] 63%|██████▎   | 212/334 [31:19<19:04,  9.38s/it] 64%|██████▍   | 213/334 [31:27<17:38,  8.75s/it] 64%|██████▍   | 214/334 [31:37<18:10,  9.09s/it] 64%|██████▍   | 215/334 [31:44<17:02,  8.59s/it] 65%|██████▍   | 216/334 [31:50<15:35,  7.93s/it] 65%|██████▍   | 217/334 [32:00<16:35,  8.51s/it] 65%|██████▌   | 218/334 [32:08<16:04,  8.32s/it] 66%|██████▌   | 219/334 [32:16<15:47,  8.24s/it] 66%|██████▌   | 220/334 [32:25<16:14,  8.55s/it] 66%|██████▌   | 221/334 [32:34<15:51,  8.42s/it] 66%|██████▋   | 222/334 [32:43<16:26,  8.81s/it] 67%|██████▋   | 223/334 [32:53<16:46,  9.07s/it] 67%|██████▋   | 224/334 [33:02<16:42,  9.12s/it] 67%|██████▋   | 225/334 [33:11<16:11,  8.91s/it] 68%|██████▊   | 226/334 [33:21<16:36,  9.23s/it] 68%|██████▊   | 227/334 [33:29<16:02,  8.99s/it] 68%|██████▊   | 228/334 [33:36<14:59,  8.49s/it] 69%|██████▊   | 229/334 [33:46<15:17,  8.73s/it] 69%|██████▉   | 230/334 [33:53<14:28,  8.35s/it] 69%|██████▉   | 231/334 [34:03<15:17,  8.90s/it] 69%|██████▉   | 232/334 [34:14<15:51,  9.33s/it] 70%|██████▉   | 233/334 [34:23<15:56,  9.47s/it] 70%|███████   | 234/334 [34:32<15:14,  9.15s/it] 70%|███████   | 235/334 [34:41<14:55,  9.05s/it] 71%|███████   | 236/334 [34:50<15:09,  9.28s/it] 71%|███████   | 237/334 [35:00<15:03,  9.31s/it] 71%|███████▏  | 238/334 [35:09<15:03,  9.41s/it] 72%|███████▏  | 239/334 [35:20<15:18,  9.66s/it] 72%|███████▏  | 240/334 [35:29<14:49,  9.46s/it] 72%|███████▏  | 241/334 [35:36<13:38,  8.80s/it] 72%|███████▏  | 242/334 [35:43<12:51,  8.38s/it] 73%|███████▎  | 243/334 [35:53<13:14,  8.73s/it] 73%|███████▎  | 244/334 [36:01<13:00,  8.68s/it] 73%|███████▎  | 245/334 [36:11<13:19,  8.98s/it] 74%|███████▎  | 246/334 [36:21<13:27,  9.18s/it] 74%|███████▍  | 247/334 [36:30<13:26,  9.27s/it] 74%|███████▍  | 248/334 [36:40<13:27,  9.39s/it] 75%|███████▍  | 249/334 [36:50<13:33,  9.56s/it] 75%|███████▍  | 250/334 [37:00<13:40,  9.77s/it] 75%|███████▌  | 251/334 [37:10<13:33,  9.80s/it] 75%|███████▌  | 252/334 [37:19<13:11,  9.65s/it] 76%|███████▌  | 253/334 [37:29<12:59,  9.62s/it] 76%|███████▌  | 254/334 [37:39<12:55,  9.70s/it] 76%|███████▋  | 255/334 [37:47<12:03,  9.16s/it] 77%|███████▋  | 256/334 [37:56<12:04,  9.28s/it] 77%|███████▋  | 257/334 [38:06<12:02,  9.39s/it] 77%|███████▋  | 258/334 [38:17<12:22,  9.78s/it] 78%|███████▊  | 259/334 [38:26<12:06,  9.69s/it] 78%|███████▊  | 260/334 [38:34<11:21,  9.21s/it] 78%|███████▊  | 261/334 [38:44<11:20,  9.32s/it] 78%|███████▊  | 262/334 [38:54<11:25,  9.52s/it] 79%|███████▊  | 263/334 [39:02<10:53,  9.21s/it] 79%|███████▉  | 264/334 [39:10<10:21,  8.88s/it] 79%|███████▉  | 265/334 [39:18<09:57,  8.66s/it] 80%|███████▉  | 266/334 [39:27<09:46,  8.63s/it] 80%|███████▉  | 267/334 [39:37<10:05,  9.04s/it] 80%|████████  | 268/334 [39:48<10:27,  9.51s/it] 81%|████████  | 269/334 [39:57<10:14,  9.45s/it] 81%|████████  | 270/334 [40:07<10:12,  9.58s/it] 81%|████████  | 271/334 [40:13<08:54,  8.48s/it] 81%|████████▏ | 272/334 [40:22<09:10,  8.88s/it] 82%|████████▏ | 273/334 [40:31<08:50,  8.70s/it] 82%|████████▏ | 274/334 [40:40<08:46,  8.78s/it] 82%|████████▏ | 275/334 [40:47<08:16,  8.41s/it] 83%|████████▎ | 276/334 [40:57<08:25,  8.71s/it] 83%|████████▎ | 277/334 [41:05<08:05,  8.52s/it] 83%|████████▎ | 278/334 [41:14<08:02,  8.61s/it] 84%|████████▎ | 279/334 [41:22<07:56,  8.65s/it] 84%|████████▍ | 280/334 [41:32<08:01,  8.91s/it] 84%|████████▍ | 281/334 [41:39<07:30,  8.50s/it] 84%|████████▍ | 282/334 [41:46<06:58,  8.05s/it] 85%|████████▍ | 283/334 [41:56<07:12,  8.48s/it] 85%|████████▌ | 284/334 [42:06<07:27,  8.95s/it] 85%|████████▌ | 285/334 [42:16<07:35,  9.30s/it] 86%|████████▌ | 286/334 [42:26<07:39,  9.58s/it] 86%|████████▌ | 287/334 [42:33<06:52,  8.79s/it] 86%|████████▌ | 288/334 [42:41<06:25,  8.39s/it] 87%|████████▋ | 289/334 [42:50<06:29,  8.65s/it] 87%|████████▋ | 290/334 [42:59<06:31,  8.89s/it] 87%|████████▋ | 291/334 [43:09<06:30,  9.07s/it] 87%|████████▋ | 292/334 [43:19<06:36,  9.43s/it] 88%|████████▊ | 293/334 [43:29<06:27,  9.45s/it] 88%|████████▊ | 294/334 [43:37<06:07,  9.19s/it] 88%|████████▊ | 295/334 [43:45<05:41,  8.76s/it] 89%|████████▊ | 296/334 [43:55<05:43,  9.03s/it] 89%|████████▉ | 297/334 [44:05<05:43,  9.29s/it] 89%|████████▉ | 298/334 [44:15<05:44,  9.58s/it] 90%|████████▉ | 299/334 [44:24<05:28,  9.39s/it] 90%|████████▉ | 300/334 [44:34<05:24,  9.54s/it] 90%|█████████ | 301/334 [44:44<05:19,  9.67s/it] 90%|█████████ | 302/334 [44:54<05:16,  9.88s/it] 91%|█████████ | 303/334 [45:04<05:06,  9.88s/it] 91%|█████████ | 304/334 [45:12<04:36,  9.22s/it] 91%|█████████▏| 305/334 [45:21<04:33,  9.41s/it] 92%|█████████▏| 306/334 [45:31<04:28,  9.57s/it] 92%|█████████▏| 307/334 [45:40<04:14,  9.44s/it] 92%|█████████▏| 308/334 [45:51<04:11,  9.67s/it] 93%|█████████▎| 309/334 [46:01<04:03,  9.73s/it] 93%|█████████▎| 310/334 [46:11<03:56,  9.84s/it] 93%|█████████▎| 311/334 [46:21<03:50, 10.00s/it] 93%|█████████▎| 312/334 [46:28<03:17,  8.97s/it] 94%|█████████▎| 313/334 [46:35<02:59,  8.57s/it] 94%|█████████▍| 314/334 [46:42<02:42,  8.14s/it] 94%|█████████▍| 315/334 [46:49<02:23,  7.56s/it] 95%|█████████▍| 316/334 [46:59<02:30,  8.34s/it] 95%|█████████▍| 317/334 [47:08<02:25,  8.56s/it] 95%|█████████▌| 318/334 [47:16<02:17,  8.58s/it] 96%|█████████▌| 319/334 [47:26<02:14,  8.98s/it] 96%|█████████▌| 320/334 [47:35<02:02,  8.78s/it] 96%|█████████▌| 321/334 [47:45<01:59,  9.22s/it] 96%|█████████▋| 322/334 [47:55<01:54,  9.57s/it] 97%|█████████▋| 323/334 [48:06<01:48,  9.84s/it] 97%|█████████▋| 324/334 [48:14<01:34,  9.50s/it] 97%|█████████▋| 325/334 [48:23<01:22,  9.19s/it] 98%|█████████▊| 326/334 [48:32<01:12,  9.07s/it] 98%|█████████▊| 327/334 [48:41<01:03,  9.08s/it] 98%|█████████▊| 328/334 [48:50<00:54,  9.09s/it] 99%|█████████▊| 329/334 [49:00<00:47,  9.47s/it] 99%|█████████▉| 330/334 [49:11<00:39,  9.77s/it] 99%|█████████▉| 331/334 [49:20<00:29,  9.71s/it] 99%|█████████▉| 332/334 [49:31<00:19,  9.87s/it]100%|█████████▉| 333/334 [49:41<00:09,  9.95s/it]100%|██████████| 334/334 [49:45<00:00,  8.15s/it]100%|██████████| 334/334 [49:45<00:00,  8.94s/it]
Saving at 250...
Saving at 334...
Completed: near scenario with random documents (3 docs)

==========================================
Running experiment: near scenario with random documents
Number of documents: 5
Gold position: 4
Use random: True
Batch size: 30
==========================================
`torch_dtype` is deprecated! Use `dtype` instead!
Loading LLM...
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:08<00:08,  8.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:10<00:00,  4.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:10<00:00,  5.34s/it]
LLM loaded
Loading corpus and search results...
Corpus and search results loaded
Loading prompt dataset...
Prompt dataset loaded
INFO:
DATA: data/10k_train_dataset.json
MODEL: meta-llama/Llama-2-7b-chat-hf
USE RANDOM IN CONTEXT: True
USE ADORE: False
GOLD POSITION: 4
NUM DOCUMENTS IN CONTEXT: 5
DOCUMENTS WITHOUT ANSWER: True
REPEAT GOLD: False
PAD GOLD: False
BATCH SIZE: 30
SAVE EVERY: 250
  0%|          | 0/334 [00:00<?, ?it/s]The following generation flags are not valid and may be ignored: ['temperature', 'top_p']. Set `TRANSFORMERS_VERBOSITY=info` for more details.
  0%|          | 1/334 [00:09<53:31,  9.64s/it]  1%|          | 2/334 [00:21<1:01:49, 11.17s/it]  1%|          | 3/334 [00:33<1:02:52, 11.40s/it]  1%|          | 4/334 [00:40<53:38,  9.75s/it]    1%|▏         | 5/334 [00:49<50:39,  9.24s/it]  2%|▏         | 6/334 [00:58<49:58,  9.14s/it]  2%|▏         | 7/334 [01:08<51:51,  9.51s/it]  2%|▏         | 8/334 [01:21<58:02, 10.68s/it]  3%|▎         | 9/334 [01:34<1:01:34, 11.37s/it]  3%|▎         | 10/334 [01:46<1:01:51, 11.46s/it]  3%|▎         | 11/334 [01:58<1:02:54, 11.69s/it]  4%|▎         | 12/334 [02:07<59:04, 11.01s/it]    4%|▍         | 13/334 [02:14<52:43,  9.86s/it]  4%|▍         | 14/334 [02:24<52:49,  9.91s/it]  4%|▍         | 15/334 [02:35<53:55, 10.14s/it]  5%|▍         | 16/334 [02:48<57:36, 10.87s/it]  5%|▌         | 17/334 [02:55<51:14,  9.70s/it]  5%|▌         | 18/334 [03:01<46:04,  8.75s/it]  6%|▌         | 19/334 [03:13<51:08,  9.74s/it]  6%|▌         | 20/334 [03:22<48:52,  9.34s/it]  6%|▋         | 21/334 [03:33<52:08, 10.00s/it]  7%|▋         | 22/334 [03:44<53:14, 10.24s/it]  7%|▋         | 23/334 [03:51<47:36,  9.19s/it]  7%|▋         | 24/334 [03:58<43:54,  8.50s/it]  7%|▋         | 25/334 [04:10<49:48,  9.67s/it]  8%|▊         | 26/334 [04:20<50:20,  9.81s/it]  8%|▊         | 27/334 [04:32<53:54, 10.54s/it]  8%|▊         | 28/334 [04:41<50:12,  9.85s/it]  9%|▊         | 29/334 [04:53<53:16, 10.48s/it]  9%|▉         | 30/334 [05:04<53:53, 10.64s/it]  9%|▉         | 31/334 [05:12<50:24,  9.98s/it] 10%|▉         | 32/334 [05:24<52:33, 10.44s/it] 10%|▉         | 33/334 [05:32<49:15,  9.82s/it] 10%|█         | 34/334 [05:42<49:33,  9.91s/it] 10%|█         | 35/334 [05:50<46:07,  9.26s/it] 11%|█         | 36/334 [05:59<45:30,  9.16s/it] 11%|█         | 37/334 [06:06<42:00,  8.49s/it] 11%|█▏        | 38/334 [06:13<40:09,  8.14s/it] 12%|█▏        | 39/334 [06:19<37:35,  7.65s/it] 12%|█▏        | 40/334 [06:27<37:11,  7.59s/it] 12%|█▏        | 41/334 [06:34<37:01,  7.58s/it] 13%|█▎        | 42/334 [06:42<36:20,  7.47s/it] 13%|█▎        | 43/334 [06:53<41:09,  8.48s/it] 13%|█▎        | 44/334 [07:01<41:15,  8.54s/it] 13%|█▎        | 45/334 [07:10<41:41,  8.66s/it] 14%|█▍        | 46/334 [07:23<47:08,  9.82s/it] 14%|█▍        | 47/334 [07:31<44:20,  9.27s/it] 14%|█▍        | 48/334 [07:43<48:51, 10.25s/it] 15%|█▍        | 49/334 [07:55<51:28, 10.84s/it] 15%|█▍        | 50/334 [08:03<46:33,  9.83s/it] 15%|█▌        | 51/334 [08:14<48:53, 10.37s/it] 16%|█▌        | 52/334 [08:26<50:12, 10.68s/it] 16%|█▌        | 53/334 [08:36<49:22, 10.54s/it] 16%|█▌        | 54/334 [08:44<45:52,  9.83s/it] 16%|█▋        | 55/334 [08:56<48:27, 10.42s/it] 17%|█▋        | 56/334 [09:03<43:31,  9.39s/it] 17%|█▋        | 57/334 [09:14<45:52,  9.94s/it] 17%|█▋        | 58/334 [09:27<49:15, 10.71s/it] 18%|█▊        | 59/334 [09:33<42:44,  9.33s/it] 18%|█▊        | 60/334 [09:42<42:33,  9.32s/it] 18%|█▊        | 61/334 [09:52<43:36,  9.59s/it] 19%|█▊        | 62/334 [10:01<41:38,  9.18s/it] 19%|█▉        | 63/334 [10:08<39:10,  8.67s/it] 19%|█▉        | 64/334 [10:20<42:57,  9.55s/it] 19%|█▉        | 65/334 [10:31<44:26,  9.91s/it] 20%|█▉        | 66/334 [10:39<41:48,  9.36s/it] 20%|██        | 67/334 [10:47<39:44,  8.93s/it] 20%|██        | 68/334 [10:53<36:18,  8.19s/it] 21%|██        | 69/334 [11:01<36:29,  8.26s/it] 21%|██        | 70/334 [11:10<36:10,  8.22s/it] 21%|██▏       | 71/334 [11:20<39:39,  9.05s/it] 22%|██▏       | 72/334 [11:30<40:04,  9.18s/it] 22%|██▏       | 73/334 [11:41<41:52,  9.63s/it] 22%|██▏       | 74/334 [11:50<40:59,  9.46s/it] 22%|██▏       | 75/334 [12:03<45:11, 10.47s/it] 23%|██▎       | 76/334 [12:15<47:50, 11.13s/it] 23%|██▎       | 77/334 [12:29<50:26, 11.78s/it] 23%|██▎       | 78/334 [12:37<45:36, 10.69s/it] 24%|██▎       | 79/334 [12:49<47:28, 11.17s/it] 24%|██▍       | 80/334 [12:59<46:20, 10.95s/it] 24%|██▍       | 81/334 [13:11<47:31, 11.27s/it] 25%|██▍       | 82/334 [13:19<43:18, 10.31s/it] 25%|██▍       | 83/334 [13:31<45:15, 10.82s/it] 25%|██▌       | 84/334 [13:44<47:07, 11.31s/it] 25%|██▌       | 85/334 [13:57<48:39, 11.73s/it] 26%|██▌       | 86/334 [14:03<42:26, 10.27s/it] 26%|██▌       | 87/334 [14:16<44:36, 10.83s/it] 26%|██▋       | 88/334 [14:26<43:14, 10.55s/it] 27%|██▋       | 89/334 [14:34<40:02,  9.80s/it] 27%|██▋       | 90/334 [14:42<38:11,  9.39s/it] 27%|██▋       | 91/334 [14:52<38:57,  9.62s/it] 28%|██▊       | 92/334 [15:02<38:33,  9.56s/it] 28%|██▊       | 93/334 [15:08<34:42,  8.64s/it] 28%|██▊       | 94/334 [15:20<38:41,  9.67s/it] 28%|██▊       | 95/334 [15:28<36:13,  9.10s/it] 29%|██▊       | 96/334 [15:35<33:20,  8.40s/it] 29%|██▉       | 97/334 [15:41<30:52,  7.82s/it] 29%|██▉       | 98/334 [15:51<33:13,  8.45s/it] 30%|██▉       | 99/334 [16:00<33:17,  8.50s/it] 30%|██▉       | 100/334 [16:12<37:48,  9.69s/it] 30%|███       | 101/334 [16:22<37:58,  9.78s/it] 31%|███       | 102/334 [16:35<40:48, 10.55s/it] 31%|███       | 103/334 [16:41<36:25,  9.46s/it] 31%|███       | 104/334 [16:49<33:54,  8.84s/it] 31%|███▏      | 105/334 [16:56<31:27,  8.24s/it] 32%|███▏      | 106/334 [17:03<30:40,  8.07s/it] 32%|███▏      | 107/334 [17:14<33:24,  8.83s/it] 32%|███▏      | 108/334 [17:22<31:59,  8.49s/it] 33%|███▎      | 109/334 [17:31<32:48,  8.75s/it] 33%|███▎      | 110/334 [17:43<36:14,  9.71s/it] 33%|███▎      | 111/334 [17:51<33:41,  9.06s/it] 34%|███▎      | 112/334 [17:58<32:20,  8.74s/it] 34%|███▍      | 113/334 [18:10<35:07,  9.54s/it] 34%|███▍      | 114/334 [18:22<38:08, 10.40s/it] 34%|███▍      | 115/334 [18:35<40:07, 10.99s/it] 35%|███▍      | 116/334 [18:47<41:00, 11.29s/it] 35%|███▌      | 117/334 [18:58<41:14, 11.40s/it] 35%|███▌      | 118/334 [19:07<38:21, 10.65s/it] 36%|███▌      | 119/334 [19:16<36:18, 10.13s/it] 36%|███▌      | 120/334 [19:25<34:30,  9.68s/it] 36%|███▌      | 121/334 [19:37<37:21, 10.53s/it] 37%|███▋      | 122/334 [19:45<34:28,  9.76s/it] 37%|███▋      | 123/334 [19:53<31:43,  9.02s/it] 37%|███▋      | 124/334 [20:02<32:04,  9.16s/it] 37%|███▋      | 125/334 [20:12<32:39,  9.37s/it] 38%|███▊      | 126/334 [20:20<31:20,  9.04s/it] 38%|███▊      | 127/334 [20:32<33:34,  9.73s/it] 38%|███▊      | 128/334 [20:44<35:47, 10.42s/it] 39%|███▊      | 129/334 [20:55<37:10, 10.88s/it] 39%|███▉      | 130/334 [21:07<37:34, 11.05s/it] 39%|███▉      | 131/334 [21:16<34:57, 10.33s/it] 40%|███▉      | 132/334 [21:26<34:34, 10.27s/it] 40%|███▉      | 133/334 [21:34<32:48,  9.79s/it] 40%|████      | 134/334 [21:46<34:41, 10.41s/it] 40%|████      | 135/334 [21:58<36:16, 10.94s/it] 41%|████      | 136/334 [22:11<37:29, 11.36s/it] 41%|████      | 137/334 [22:18<32:55, 10.03s/it] 41%|████▏     | 138/334 [22:30<35:16, 10.80s/it] 42%|████▏     | 139/334 [22:42<35:45, 11.00s/it] 42%|████▏     | 140/334 [22:49<32:01,  9.90s/it] 42%|████▏     | 141/334 [22:57<29:42,  9.24s/it] 43%|████▎     | 142/334 [23:06<29:45,  9.30s/it] 43%|████▎     | 143/334 [23:19<32:55, 10.34s/it] 43%|████▎     | 144/334 [23:26<29:59,  9.47s/it] 43%|████▎     | 145/334 [23:34<28:11,  8.95s/it] 44%|████▎     | 146/334 [23:41<25:51,  8.25s/it] 44%|████▍     | 147/334 [23:48<24:36,  7.90s/it] 44%|████▍     | 148/334 [23:59<27:10,  8.77s/it] 45%|████▍     | 149/334 [24:09<28:09,  9.13s/it] 45%|████▍     | 150/334 [24:21<30:50, 10.06s/it] 45%|████▌     | 151/334 [24:31<30:19,  9.94s/it] 46%|████▌     | 152/334 [24:43<32:04, 10.57s/it] 46%|████▌     | 153/334 [24:49<28:10,  9.34s/it] 46%|████▌     | 154/334 [24:55<25:22,  8.46s/it] 46%|████▋     | 155/334 [25:03<24:24,  8.18s/it] 47%|████▋     | 156/334 [25:12<24:46,  8.35s/it] 47%|████▋     | 157/334 [25:24<27:47,  9.42s/it] 47%|████▋     | 158/334 [25:30<25:09,  8.58s/it] 48%|████▊     | 159/334 [25:43<28:15,  9.69s/it] 48%|████▊     | 160/334 [25:51<27:27,  9.47s/it] 48%|████▊     | 161/334 [26:01<27:09,  9.42s/it] 49%|████▊     | 162/334 [26:13<29:27, 10.28s/it] 49%|████▉     | 163/334 [26:22<28:09,  9.88s/it] 49%|████▉     | 164/334 [26:34<29:33, 10.43s/it] 49%|████▉     | 165/334 [26:47<31:41, 11.25s/it] 50%|████▉     | 166/334 [26:59<32:20, 11.55s/it] 50%|█████     | 167/334 [27:10<31:21, 11.27s/it] 50%|█████     | 168/334 [27:21<31:30, 11.39s/it] 51%|█████     | 169/334 [27:28<27:19,  9.93s/it] 51%|█████     | 170/334 [27:36<25:26,  9.31s/it] 51%|█████     | 171/334 [27:48<27:34, 10.15s/it] 51%|█████▏    | 172/334 [28:02<30:53, 11.44s/it] 52%|█████▏    | 173/334 [28:10<27:19, 10.18s/it] 52%|█████▏    | 174/334 [28:21<28:28, 10.68s/it] 52%|█████▏    | 175/334 [28:29<25:56,  9.79s/it] 53%|█████▎    | 176/334 [28:36<23:22,  8.88s/it] 53%|█████▎    | 177/334 [28:47<24:41,  9.44s/it] 53%|█████▎    | 178/334 [28:57<24:52,  9.57s/it] 54%|█████▎    | 179/334 [29:08<26:11, 10.14s/it] 54%|█████▍    | 180/334 [29:15<23:41,  9.23s/it] 54%|█████▍    | 181/334 [29:27<25:45, 10.10s/it] 54%|█████▍    | 182/334 [29:34<22:44,  8.98s/it] 55%|█████▍    | 183/334 [29:45<24:46,  9.84s/it] 55%|█████▌    | 184/334 [29:56<24:45,  9.90s/it] 55%|█████▌    | 185/334 [30:08<26:16, 10.58s/it] 56%|█████▌    | 186/334 [30:20<27:26, 11.13s/it] 56%|█████▌    | 187/334 [30:32<28:05, 11.46s/it] 56%|█████▋    | 188/334 [30:40<25:27, 10.46s/it] 57%|█████▋    | 189/334 [30:50<24:23, 10.09s/it] 57%|█████▋    | 190/334 [30:59<23:55,  9.97s/it] 57%|█████▋    | 191/334 [31:07<21:43,  9.12s/it] 57%|█████▋    | 192/334 [31:19<24:07, 10.20s/it] 58%|█████▊    | 193/334 [31:30<24:32, 10.44s/it] 58%|█████▊    | 194/334 [31:41<24:39, 10.57s/it] 58%|█████▊    | 195/334 [31:48<22:05,  9.53s/it] 59%|█████▊    | 196/334 [31:56<20:55,  9.10s/it] 59%|█████▉    | 197/334 [32:05<20:29,  8.97s/it] 59%|█████▉    | 198/334 [32:16<21:48,  9.62s/it] 60%|█████▉    | 199/334 [32:27<22:39, 10.07s/it] 60%|█████▉    | 200/334 [32:37<21:58,  9.84s/it] 60%|██████    | 201/334 [32:46<21:24,  9.66s/it] 60%|██████    | 202/334 [32:53<19:37,  8.92s/it] 61%|██████    | 203/334 [33:06<21:50, 10.01s/it] 61%|██████    | 204/334 [33:14<20:55,  9.66s/it] 61%|██████▏   | 205/334 [33:24<20:40,  9.62s/it] 62%|██████▏   | 206/334 [33:33<19:57,  9.36s/it] 62%|██████▏   | 207/334 [33:42<20:01,  9.46s/it] 62%|██████▏   | 208/334 [33:52<19:48,  9.43s/it] 63%|██████▎   | 209/334 [33:58<17:47,  8.54s/it] 63%|██████▎   | 210/334 [34:05<16:43,  8.09s/it] 63%|██████▎   | 211/334 [34:14<17:15,  8.42s/it] 63%|██████▎   | 212/334 [34:21<16:09,  7.94s/it] 64%|██████▍   | 213/334 [34:29<16:08,  8.00s/it] 64%|██████▍   | 214/334 [34:41<18:22,  9.19s/it] 64%|██████▍   | 215/334 [34:48<16:30,  8.33s/it] 65%|██████▍   | 216/334 [34:57<16:53,  8.59s/it] 65%|██████▍   | 217/334 [35:09<18:48,  9.65s/it] 65%|██████▌   | 218/334 [35:18<18:27,  9.55s/it] 66%|██████▌   | 219/334 [35:30<19:32, 10.19s/it] 66%|██████▌   | 220/334 [35:38<18:16,  9.62s/it] 66%|██████▌   | 221/334 [35:45<16:15,  8.64s/it] 66%|██████▋   | 222/334 [35:54<16:37,  8.90s/it] 67%|██████▋   | 223/334 [36:06<18:22,  9.93s/it] 67%|██████▋   | 224/334 [36:16<18:07,  9.89s/it] 67%|██████▋   | 225/334 [36:25<17:27,  9.61s/it] 68%|██████▊   | 226/334 [36:34<16:46,  9.32s/it] 68%|██████▊   | 227/334 [36:44<16:50,  9.45s/it] 68%|██████▊   | 228/334 [36:50<15:18,  8.66s/it] 69%|██████▊   | 229/334 [37:00<15:43,  8.98s/it] 69%|██████▉   | 230/334 [37:09<15:25,  8.90s/it] 69%|██████▉   | 231/334 [37:21<16:54,  9.85s/it] 69%|██████▉   | 232/334 [37:33<17:56, 10.55s/it] 70%|██████▉   | 233/334 [37:44<18:06, 10.76s/it] 70%|███████   | 234/334 [37:56<18:27, 11.07s/it] 70%|███████   | 235/334 [38:09<19:07, 11.59s/it] 71%|███████   | 236/334 [38:19<17:58, 11.01s/it] 71%|███████   | 237/334 [38:31<18:31, 11.46s/it] 71%|███████▏  | 238/334 [38:37<15:53,  9.93s/it] 72%|███████▏  | 239/334 [38:47<15:30,  9.80s/it] 72%|███████▏  | 240/334 [39:00<16:43, 10.67s/it] 72%|███████▏  | 241/334 [39:06<14:35,  9.41s/it] 72%|███████▏  | 242/334 [39:18<15:37, 10.19s/it] 73%|███████▎  | 243/334 [39:30<16:07, 10.63s/it] 73%|███████▎  | 244/334 [39:42<16:48, 11.20s/it] 73%|███████▎  | 245/334 [39:51<15:18, 10.32s/it] 74%|███████▎  | 246/334 [39:59<14:27,  9.86s/it] 74%|███████▍  | 247/334 [40:07<13:16,  9.15s/it] 74%|███████▍  | 248/334 [40:13<11:52,  8.29s/it] 75%|███████▍  | 249/334 [40:26<13:36,  9.61s/it] 75%|███████▍  | 250/334 [40:38<14:28, 10.34s/it] 75%|███████▌  | 251/334 [40:48<14:24, 10.41s/it] 75%|███████▌  | 252/334 [40:57<13:16,  9.71s/it] 76%|███████▌  | 253/334 [41:08<13:53, 10.29s/it] 76%|███████▌  | 254/334 [41:18<13:24, 10.05s/it] 76%|███████▋  | 255/334 [41:29<13:48, 10.48s/it] 77%|███████▋  | 256/334 [41:41<14:04, 10.83s/it] 77%|███████▋  | 257/334 [41:52<14:11, 11.06s/it] 77%|███████▋  | 258/334 [42:05<14:44, 11.64s/it] 78%|███████▊  | 259/334 [42:17<14:32, 11.63s/it] 78%|███████▊  | 260/334 [42:26<13:18, 10.79s/it] 78%|███████▊  | 261/334 [42:38<13:29, 11.09s/it] 78%|███████▊  | 262/334 [42:45<11:56,  9.95s/it] 79%|███████▊  | 263/334 [42:54<11:30,  9.72s/it] 79%|███████▉  | 264/334 [43:02<10:50,  9.29s/it] 79%|███████▉  | 265/334 [43:14<11:30, 10.00s/it] 80%|███████▉  | 266/334 [43:24<11:26, 10.09s/it] 80%|███████▉  | 267/334 [43:37<11:59, 10.74s/it] 80%|████████  | 268/334 [43:50<12:31, 11.39s/it] 81%|████████  | 269/334 [44:00<11:59, 11.07s/it] 81%|████████  | 270/334 [44:13<12:34, 11.80s/it] 81%|████████  | 271/334 [44:23<11:43, 11.17s/it] 81%|████████▏ | 272/334 [44:35<11:47, 11.42s/it] 82%|████████▏ | 273/334 [44:44<10:44, 10.57s/it] 82%|████████▏ | 274/334 [44:51<09:27,  9.46s/it] 82%|████████▏ | 275/334 [45:02<09:53, 10.06s/it] 83%|████████▎ | 276/334 [45:09<08:55,  9.24s/it] 83%|████████▎ | 277/334 [45:16<07:55,  8.35s/it] 83%|████████▎ | 278/334 [45:26<08:20,  8.93s/it] 84%|████████▎ | 279/334 [45:38<09:11, 10.04s/it] 84%|████████▍ | 280/334 [45:50<09:30, 10.57s/it] 84%|████████▍ | 281/334 [46:03<09:48, 11.11s/it] 84%|████████▍ | 282/334 [46:11<08:59, 10.37s/it] 85%|████████▍ | 283/334 [46:19<08:09,  9.59s/it] 85%|████████▌ | 284/334 [46:26<07:26,  8.92s/it] 85%|████████▌ | 285/334 [46:39<08:10, 10.01s/it] 86%|████████▌ | 286/334 [46:50<08:19, 10.40s/it] 86%|████████▌ | 287/334 [46:57<07:16,  9.28s/it] 86%|████████▌ | 288/334 [47:04<06:41,  8.73s/it] 87%|████████▋ | 289/334 [47:11<06:03,  8.07s/it] 87%|████████▋ | 290/334 [47:19<05:58,  8.14s/it] 87%|████████▋ | 291/334 [47:28<05:56,  8.30s/it] 87%|████████▋ | 292/334 [47:38<06:09,  8.81s/it] 88%|████████▊ | 293/334 [47:46<05:54,  8.65s/it] 88%|████████▊ | 294/334 [47:55<05:53,  8.84s/it] 88%|████████▊ | 295/334 [48:03<05:30,  8.47s/it] 89%|████████▊ | 296/334 [48:12<05:25,  8.58s/it] 89%|████████▉ | 297/334 [48:19<05:03,  8.20s/it] 89%|████████▉ | 298/334 [48:32<05:41,  9.48s/it] 90%|████████▉ | 299/334 [48:44<06:04, 10.41s/it] 90%|████████▉ | 300/334 [48:51<05:12,  9.18s/it] 90%|█████████ | 301/334 [48:59<04:54,  8.93s/it] 90%|█████████ | 302/334 [49:12<05:21, 10.06s/it] 91%|█████████ | 303/334 [49:24<05:31, 10.68s/it] 91%|█████████ | 304/334 [49:34<05:16, 10.54s/it] 91%|█████████▏| 305/334 [49:44<04:59, 10.33s/it] 92%|█████████▏| 306/334 [49:51<04:24,  9.45s/it] 92%|█████████▏| 307/334 [49:59<04:01,  8.95s/it] 92%|█████████▏| 308/334 [50:07<03:48,  8.81s/it] 93%|█████████▎| 309/334 [50:16<03:41,  8.87s/it] 93%|█████████▎| 310/334 [50:29<03:57,  9.91s/it] 93%|█████████▎| 311/334 [50:38<03:42,  9.68s/it] 93%|█████████▎| 312/334 [50:47<03:26,  9.38s/it] 94%|█████████▎| 313/334 [50:57<03:25,  9.77s/it] 94%|█████████▍| 314/334 [51:09<03:24, 10.21s/it] 94%|█████████▍| 315/334 [51:17<03:01,  9.55s/it] 95%|█████████▍| 316/334 [51:27<02:54,  9.70s/it] 95%|█████████▍| 317/334 [51:35<02:37,  9.28s/it] 95%|█████████▌| 318/334 [51:42<02:18,  8.66s/it] 96%|█████████▌| 319/334 [51:53<02:21,  9.42s/it] 96%|█████████▌| 320/334 [52:06<02:24, 10.30s/it] 96%|█████████▌| 321/334 [52:19<02:26, 11.28s/it] 96%|█████████▋| 322/334 [52:30<02:12, 11.04s/it] 97%|█████████▋| 323/334 [52:37<01:48,  9.83s/it] 97%|█████████▋| 324/334 [52:47<01:40, 10.06s/it] 97%|█████████▋| 325/334 [53:00<01:36, 10.71s/it] 98%|█████████▊| 326/334 [53:06<01:15,  9.47s/it] 98%|█████████▊| 327/334 [53:17<01:10, 10.01s/it] 98%|█████████▊| 328/334 [53:29<01:02, 10.40s/it] 99%|█████████▊| 329/334 [53:36<00:47,  9.45s/it] 99%|█████████▉| 330/334 [53:47<00:40, 10.03s/it] 99%|█████████▉| 331/334 [54:00<00:32, 10.78s/it] 99%|█████████▉| 332/334 [54:10<00:20, 10.46s/it]100%|█████████▉| 333/334 [54:20<00:10, 10.38s/it]100%|██████████| 334/334 [54:28<00:00,  9.73s/it]100%|██████████| 334/334 [54:28<00:00,  9.79s/it]
Saving at 250...
Saving at 334...
Completed: near scenario with random documents (5 docs)

==========================================
Running experiment: near scenario with random documents
Number of documents: 7
Gold position: 6
Use random: True
Batch size: 30
==========================================
`torch_dtype` is deprecated! Use `dtype` instead!
Loading LLM...
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:07<00:07,  7.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:10<00:00,  4.84s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:10<00:00,  5.30s/it]
LLM loaded
Loading corpus and search results...
Corpus and search results loaded
Loading prompt dataset...
Prompt dataset loaded
INFO:
DATA: data/10k_train_dataset.json
MODEL: meta-llama/Llama-2-7b-chat-hf
USE RANDOM IN CONTEXT: True
USE ADORE: False
GOLD POSITION: 6
NUM DOCUMENTS IN CONTEXT: 7
DOCUMENTS WITHOUT ANSWER: True
REPEAT GOLD: False
PAD GOLD: False
BATCH SIZE: 30
SAVE EVERY: 250
  0%|          | 0/334 [00:00<?, ?it/s]The following generation flags are not valid and may be ignored: ['temperature', 'top_p']. Set `TRANSFORMERS_VERBOSITY=info` for more details.
  0%|          | 0/334 [00:04<?, ?it/s]
Traceback (most recent call last):
  File "/gpfs/home1/scur2158/The-Power-of-Noise/src/generate_answers_llm.py", line 216, in <module>
    main()
    ~~~~^^
  File "/gpfs/home1/scur2158/The-Power-of-Noise/src/generate_answers_llm.py", line 210, in main
    generate_and_save(args, llm, prompt_dataloader)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/home1/scur2158/The-Power-of-Noise/src/generate_answers_llm.py", line 166, in generate_and_save
    generated_output = llm.generate(prompts, max_new_tokens=args.max_new_tokens)
  File "/gpfs/home1/scur2158/The-Power-of-Noise/src/llm.py", line 119, in generate
    generated_ids = self.model.generate(
        **inputs,
    ...<5 lines>...
        eos_token_id=self.tokenizer.eos_token_id,
    )
  File "/home/scur2158/.local/lib/python3.13/site-packages/torch/utils/_contextlib.py", line 120, in decorate_context
    return func(*args, **kwargs)
  File "/home/scur2158/.local/lib/python3.13/site-packages/transformers/generation/utils.py", line 2564, in generate
    result = decoding_method(
        self,
    ...<5 lines>...
        **model_kwargs,
    )
  File "/home/scur2158/.local/lib/python3.13/site-packages/transformers/generation/utils.py", line 2784, in _sample
    outputs = self(**model_inputs, return_dict=True)
  File "/home/scur2158/.local/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/scur2158/.local/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/scur2158/.local/lib/python3.13/site-packages/transformers/utils/generic.py", line 918, in wrapper
    output = func(self, *args, **kwargs)
  File "/home/scur2158/.local/lib/python3.13/site-packages/transformers/models/llama/modeling_llama.py", line 459, in forward
    outputs: BaseModelOutputWithPast = self.model(
                                       ~~~~~~~~~~^
        input_ids=input_ids,
        ^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/scur2158/.local/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/scur2158/.local/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/scur2158/.local/lib/python3.13/site-packages/transformers/utils/generic.py", line 1064, in wrapper
    outputs = func(self, *args, **kwargs)
  File "/home/scur2158/.local/lib/python3.13/site-packages/transformers/models/llama/modeling_llama.py", line 395, in forward
    hidden_states = decoder_layer(
        hidden_states,
    ...<5 lines>...
        **kwargs,
    )
  File "/home/scur2158/.local/lib/python3.13/site-packages/transformers/modeling_layers.py", line 94, in __call__
    return super().__call__(*args, **kwargs)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/scur2158/.local/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/scur2158/.local/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/scur2158/.local/lib/python3.13/site-packages/transformers/utils/deprecation.py", line 172, in wrapped_func
    return func(*args, **kwargs)
  File "/home/scur2158/.local/lib/python3.13/site-packages/transformers/models/llama/modeling_llama.py", line 309, in forward
    hidden_states = self.mlp(hidden_states)
  File "/home/scur2158/.local/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/scur2158/.local/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/scur2158/.local/lib/python3.13/site-packages/transformers/models/llama/modeling_llama.py", line 155, in forward
    down_proj = self.down_proj(self.act_fn(self.gate_proj(x)) * self.up_proj(x))
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 1006.00 MiB. GPU 0 has a total capacity of 39.49 GiB of which 831.25 MiB is free. Including non-PyTorch memory, this process has 38.67 GiB memory in use. Of the allocated memory 29.03 GiB is allocated by PyTorch, and 9.14 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
Completed: near scenario with random documents (7 docs)

==========================================
All experiments completed!
==========================================
